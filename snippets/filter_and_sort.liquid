{% capture collectionFilter %}
  {%- for filter in collection.filters -%}
      {%- if filter.type == 'price_range' -%}
        {%- if filter.min_value.value != null or filter.max_value.value != null -%}
          <div class="active-filters">
            <a class="active-filters__remove-filter" href="{{ filter.url_to_remove }}">
              {%- assign min_value = filter.min_value.value | default: 0 -%}
              {%- assign max_value = filter.max_value.value | default: filter.range_max -%}
              {{ min_value | money }} - <strong>{{ max_value | money }}</strong>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="7"
                height="8"
                viewBox="0 0 7 8"
                fill="none"
              >
                <path d="M0.5 1L6.5 7" stroke="#6C6C6C" stroke-opacity="0.8" stroke-width="0.8"
                    stroke-linecap="round" />
                <path d="M6.5 1L0.5 7" stroke="#6C6C6C" stroke-opacity="0.8" stroke-width="0.8"
                    stroke-linecap="round" />
              </svg>
            </a>
          </div>
        {%- endif -%}
      {%- else -%}
        {%- for filter_value in filter.active_values -%}
          <div class="active-filters">
            <span class="active-filters__remove-filter user-select-none">
              {{ filter_value.label }}
              <a href="{{ filter_value.url_to_remove }}" class="no-line text-muted font-weight-bold ml-2">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="7"
                  height="8"
                  viewBox="0 0 7 8"
                  fill="none"
                >
                  <path d="M0.5 1L6.5 7" stroke="#6C6C6C" stroke-opacity="0.8" stroke-width="0.8"
                      stroke-linecap="round" />
                  <path d="M6.5 1L0.5 7" stroke="#6C6C6C" stroke-opacity="0.8" stroke-width="0.8"
                      stroke-linecap="round" />
                </svg>
              </a>
            </span>
          </div>
          {% assign filterApplied = true %}
        {%- endfor -%}
      {%- endif -%}
    {%- endfor -%}
  {% endcapture %}
<div class="filter-methods-container d-none d-sm-flex gap-4">
  <div class="filter-tags">
    {{ collectionFilter }}
  </div>

  <div class="filter-methods d-none d-sm-flex">
    <button class="filters filter-btn">
      <svg xmlns="http://www.w3.org/2000/svg" width="26" height="23" viewBox="0 0 26 23" fill="none">
        <path d="M22.3545 11.2842L22.3545 21.5686" stroke="#393939" stroke-width="1.5" stroke-linecap="round" />
        <path d="M22.3545 1L22.3545 6.14219" stroke="#393939" stroke-width="1.5" stroke-linecap="round" />
        <circle cx="22.3547" cy="8.71308" r="2.5711" transform="rotate(-180 22.3547 8.71308)" stroke="#393939"
            stroke-width="1.5" stroke-linecap="round" />
        <path d="M4.07129 11.2842L4.07129 21.5686" stroke="#393939" stroke-width="1.5" stroke-linecap="round" />
        <path d="M4.07129 1L4.07129 6.14219" stroke="#393939" stroke-width="1.5" stroke-linecap="round" />
        <circle cx="4.07148" cy="8.71308" r="2.5711" transform="rotate(-180 4.07148 8.71308)" stroke="#393939"
            stroke-width="1.5" stroke-linecap="round" />
        <path d="M13.2129 18.1431L13.2129 21.9997" stroke="#393939" stroke-width="1.5" stroke-linecap="round" />
        <path d="M13.2129 1.43115L13.2129 11.7155" stroke="#393939" stroke-width="1.5" stroke-linecap="round" />
        <circle cx="13.2131" cy="15.572" r="2.5711" transform="rotate(-180 13.2131 15.572)" stroke="#393939"
            stroke-width="1.5" stroke-linecap="round" />
      </svg>
      <p>Filters</p>
    </button>
    <button class="sort-by">
      <p class="sort-btn">Sort By</p>
    </button>
  </div>
</div>

<!-- small device filter -->
<div class="m-filter-methods d-sm-none">
  <button class="sort-btn">
    <svg
      class="mobile-screen"
      width="18"
      height="24"
      viewBox="0 0 18 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <g id="Group 9115">
          <path id="Vector 9"
              d="M5 2L4.46967 1.46967L5 0.93934L5.53033 1.46967L5 2ZM5.75 17C5.75 17.4142 5.41421 17.75 5 17.75C4.58579 17.75 4.25 17.4142 4.25 17L5.75 17ZM0.46967 5.46967L4.46967 1.46967L5.53033 2.53033L1.53033 6.53033L0.46967 5.46967ZM5.53033 1.46967L9.53033 5.46967L8.46967 6.53033L4.46967 2.53033L5.53033 1.46967ZM5.75 2L5.75 17L4.25 17L4.25 2L5.75 2Z"
              fill="#393939" />
          <path id="Vector 10"
              d="M13 22L12.4697 22.5303L13 23.0607L13.5303 22.5303L13 22ZM13.75 7C13.75 6.58579 13.4142 6.25 13 6.25C12.5858 6.25 12.25 6.58579 12.25 7L13.75 7ZM8.46967 18.5303L12.4697 22.5303L13.5303 21.4697L9.53033 17.4697L8.46967 18.5303ZM13.5303 22.5303L17.5303 18.5303L16.4697 17.4697L12.4697 21.4697L13.5303 22.5303ZM13.75 22L13.75 7L12.25 7L12.25 22L13.75 22Z"
              fill="#393939" />
      </g>
    </svg>
    <p>Sort By <span>Popularity</span></p>
  </button>

  <div class="line"></div>

  <button class="filter-btn">
    <svg xmlns="http://www.w3.org/2000/svg" width="26" height="23" viewBox="0 0 26 23" fill="none">
      <path d="M22.3545 11.2842L22.3545 21.5686" stroke="#393939" stroke-width="1.5" stroke-linecap="round" />
      <path d="M22.3545 1L22.3545 6.14219" stroke="#393939" stroke-width="1.5" stroke-linecap="round" />
      <circle cx="22.3547" cy="8.71308" r="2.5711" transform="rotate(-180 22.3547 8.71308)" stroke="#393939"
          stroke-width="1.5" stroke-linecap="round" />
      <path d="M4.07129 11.2842L4.07129 21.5686" stroke="#393939" stroke-width="1.5" stroke-linecap="round" />
      <path d="M4.07129 1L4.07129 6.14219" stroke="#393939" stroke-width="1.5" stroke-linecap="round" />
      <circle cx="4.07148" cy="8.71308" r="2.5711" transform="rotate(-180 4.07148 8.71308)" stroke="#393939"
          stroke-width="1.5" stroke-linecap="round" />
      <path d="M13.2129 18.1431L13.2129 21.9997" stroke="#393939" stroke-width="1.5" stroke-linecap="round" />
      <path d="M13.2129 1.43115L13.2129 11.7155" stroke="#393939" stroke-width="1.5" stroke-linecap="round" />
      <circle cx="13.2131" cy="15.572" r="2.5711" transform="rotate(-180 13.2131 15.572)" stroke="#393939"
          stroke-width="1.5" stroke-linecap="round" />
    </svg>
    <p>Filters<span>No Filter Applied</span></p>
  </button>
</div>

<div class="filter-slides">
  <div class="overlay"></div>

  <div class="filters-slide">
    <form id="filter-form">
      {% if template == "search" %}
      <input type="hidden"
      placeholder="Search"
      name="q"
      value="{{ search.terms | escape }}"
    />
      {% endif %}
      <div class="filter-controls-container flex-row flex-md-column justify-content-between">
        <div class="filter-controls">
          <div class="filter-close">
            <button class="filter-btn">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="11"
                height="18"
                viewBox="0 0 11 18"
                fill="none"
              >
                <path d="M1 1L9 9L1 17" stroke="#393939" stroke-width="2" stroke-linecap="round" />
              </svg>
            </button>
            <p class="mb-0">Filter By</p>
          </div>
          <button type="submit" class="apply-btn d-none d-md-block">Apply Filter</button>
        </div>
        <button type="reset" class="reset-btn">Clear All</button>
      </div>

      <div class="filter-tags d-lg-none">
        {{ collectionFilter }}
      </div>

      <ul class="filter-props-container">
        {%- for filter in collection.filters -%}
          {% unless filter.label == "Product Category"  %}
          <li class="filter-props">
            <input type="checkbox" value="{{ filter.label }}" id="{{ filter.label |  replace: ' ','_'  }}" class="d-none">
          <label for="{{ filter.label |  replace: ' ','_' }}"> {% if filter.label == "Product Sub Category" %}Product Category{% else %}{{ filter.label | capitalize }}{% endif %}</label>
            <ul>
              {% if filter.label == 'Price' %}
                {%- assign min_value = filter.min_value.value | default: 0 -%}
                {%- assign max_value = filter.max_value.value | default: filter.range_max -%}

                <div class="price-display-container">
                  <span class="min-price-display">{{ min_value | money_without_trailing_zeros }}</span>
                  <span class="max-price-display">{{ filter.range_max | money_without_trailing_zeros }}</span>
                </div>
                <div class="price-slider-box">
                  <input type="text" id="priceRange" readonly class="d-none">
                  <div
                    id="price-range"
                    class="price-slider"
                    min="{{ min_value | divided_by:100 }}"
                    max="{{ max_value | divided_by:100 }}"
                    max-range="{{ filter.range_max | divided_by:100 }}"
                    {{ filter.range_max | divided_by: 100 }}
                  ></div>
                </div>
              {% endif %}

              {%- for filter_value in filter.values -%}
                {% if filter_value.count >= 1 -%}
                  <li>
                    <label for="{{ filter_value.value }}" label="filter">
                      {{ filter_value.label | capitalize -}}
                      <span> ({{ filter_value.count }})</span>
                    </label>
                    <input
                      type="checkbox"
                      checkfield="filter"
                      name="{{ filter_value.param_name }}"
                      id="{{ filter_value.value }}"
                      value="{{ filter_value.value }}"
                      {% if filter_value.active -%}
                        checked
                      {%- endif %}
                      {% if filter_value.count == 0 and filter_value.active == false -%}
                        disabled
                      {%- endif %}
                    >
                  </li>
                {%- endif %}
              {% endfor %}
            </ul>
          </li>
            {% endunless %}
        {% endfor %}
      </ul>
      <div class="m-apply-btn-container d-lg-none">
        <button type="submit" class="m-apply-btn">Apply Filter</button>
      </div>
    </form>
  </div>

  <div class="sort-by-slide">
    <form id="sort-submit">
      <div class="sort-controls-container flex-row flex-md-column justify-content-between">
        <div class="sort-controls">
          <div class="sort-close">
            <button class="sort-btn">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="11"
                height="18"
                viewBox="0 0 11 18"
                fill="none"
              >
                <path d="M1 1L9 9L1 17" stroke="#393939" stroke-width="2" stroke-linecap="round" />
              </svg>
            </button>

            <p class="mb-0">Sort By</p>
          </div>
          {% comment %} <button type="submit" class="sort-apply-btn d-none d-md-block">Apply Sort</button> {% endcomment %}
        </div>
      </div>
      {% assign sort_by = collection.sort_by | default: collection.default_sort_by %}
      <ul class="sort-props-container">
        {% for option in collection.sort_options %}
          <li class="sort-props">
            <input
              type="radio"
              value="{{ option.value }}"
              id="{{ option.value }}"
              name="sort-label"
              {% if option.value == sort_by %}
                checked
              {% endif %}
              class="d-none"
            >
            <label for="{{ option.value }}">
              {% if option.value == 'best-selling' %}Popularity{% else %}{{ option.name }}{% endif %}
            </label>
          </li>
        {% endfor %}
      </ul>

      <div class="m-sort-apply-btn-container d-none">
        <button type="submit" class="m-sort-apply-btn ">Apply sort</button>
      </div>
    </form>
  </div>
</div>
<style>
    .price-display-container{
      display:flex;
      justify-content:space-between;
      margin-top:16px;
    }
    .price-display-container>span{
      color: #585858;
  font-family: Montserrat;
  font-size: 14px;
  font-style: normal;
  font-weight: 400 !important;
  line-height: 20px; /* 153.846% */
  text-transform: capitalize;
    }
     .price-slider-box {
        padding:0 12px;
     }
    .price-slider-box label,.price-slider-box input{
      border: none;
      display: inline-block;
      margin-right: -4px;
      vertical-align: top;
      width: 30%
    }
    .price-slider-box input {
      width: 70%
    }
     .price-slider {
       margin: 8px 0;
      border-radius:10px;
       background:#F2F2F2;
       display:flex;
       align-items:center;
       height:8px;
       border:none;
     }
    .price-slider > div.ui-slider-range {
      background: #D6D8F9 !important;
    }
    .price-slider > span{
      top:unset !important;
      border-radius:50%;
      border:2px solid #8F92D4 !important;
      background: #fff !important;
      margin:0;
      width:16px !important;
      height:16px !important;
    }
  @media screen and (max-width:992px){
    .price-display-container>span{
      font-size:13px;
    }
  }
</style>
{% if template == "search" %}
<script>
  // document.getElementById('filter-form').addEventListener('submit', function (event) {
  //        event.preventDefault();
  //        debugger;
  //        const link = window.location.href;
  //        const regex = /\?q=([^&]+)/;
  //         const match = link.match(regex);
  //         const searchValue = match ? match[1] : null;
  //        var newUrl = searchValue;
  //        console.log(searchValue);
  //        if (selectedTag) {
  //            newUrl += '?tag=' + selectedTag;
  //        }
  //        window.location.href = newUrl;
  //    });
</script>
{% endif %}
